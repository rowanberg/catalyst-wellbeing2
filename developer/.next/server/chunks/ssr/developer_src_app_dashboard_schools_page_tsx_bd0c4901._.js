module.exports=[77877,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(62036),f=a.i(67900),g=a.i(87532),h=a.i(15618),i=a.i(95756),j=a.i(41710),k=a.i(54018),l=a.i(60246),m=a.i(3314),n=a.i(50522),o=a.i(26017),p=a.i(80208),q=a.i(24987),r=a.i(16501);function s(){let[a,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)("linked"),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)(!1);(0,c.useEffect)(()=>{R()},[]),(0,c.useEffect)(()=>{x&&(S(),T())},[x]);let R=async()=>{try{let{data:{user:a}}=await r.devSupabase.auth.getUser();if(!a)return;let{data:b}=await r.devSupabase.from("developer_accounts").select("id").eq("auth_user_id",a.id).single();if(!b)return;let{data:c}=await r.devSupabase.from("developer_applications").select("id, name, status").eq("developer_id",b.id).eq("status","approved");c&&c.length>0&&(w(c),y(c[0].id)),E([{id:"sch_001",name:"Springfield High School",code:"SHS",location:{city:"Springfield",state:"IL",country:"USA"},student_count:1250,type:"high_school"},{id:"sch_002",name:"Riverside Elementary",code:"RES",location:{city:"Portland",state:"OR",country:"USA"},student_count:450,type:"elementary"},{id:"sch_003",name:"Oakwood International Academy",code:"OIA",location:{city:"Austin",state:"TX",country:"USA"},student_count:890,type:"international"},{id:"sch_004",name:"Mumbai Central School",code:"MCS",location:{city:"Mumbai",state:"MH",country:"India"},student_count:2100,type:"cbse"},{id:"sch_005",name:"Delhi Public School",code:"DPS",location:{city:"New Delhi",state:"DL",country:"India"},student_count:3500,type:"cbse"}])}catch(a){console.error("Error loading data:",a)}finally{s(!1)}},S=async()=>{try{let a=await fetch(`/api/schools/linked?application_id=${x}`);if(a.ok){let b=await a.json();A(b.schools||[])}}catch(a){console.error("Error loading linked schools:",a),A([{school_id:"sch_001",school_name:"Springfield High School",school_code:"SHS",location:{city:"Springfield",state:"IL"},linked_at:new Date(Date.now()-2592e6).toISOString(),approved_scopes:["student.profile.read","student.attendance.read"],usage:{api_calls_30d:15420,active_users:245}}])}},T=async()=>{try{let a=await fetch(`/api/schools/request?application_id=${x}`);if(a.ok){let b=await a.json();C(b.requests||[])}}catch(a){console.error("Error loading access requests:",a),C([{id:"req_001",school_id:"sch_003",school_name:"Oakwood International Academy",status:"pending",requested_at:new Date(Date.now()-1728e5).toISOString(),purpose:"To provide tutoring services",requested_scopes:["student.profile.read","student.academic.read"]}])}},U=async()=>{if(J&&L&&0!==N.length){Q(!0);try{(await fetch("/api/schools/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({application_id:x,school_id:J.id,purpose:L,requested_scopes:N})})).ok&&(I(!1),K(null),M(""),O([]),T())}catch(a){console.error("Error requesting access:",a)}finally{Q(!1)}}},V=D.filter(a=>a.name.toLowerCase().includes(F.toLowerCase())||a.code.toLowerCase().includes(F.toLowerCase())||a.location.city.toLowerCase().includes(F.toLowerCase()));return a?(0,b.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(o.Loader2,{className:"w-8 h-8 text-blue-500 animate-spin"}),(0,b.jsx)("p",{className:"text-slate-400",children:"Loading school connections..."})]})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-white flex items-center gap-3",children:[(0,b.jsx)(f.Building2,{className:"w-8 h-8 text-blue-400"}),"School Connections"]}),(0,b.jsx)("p",{className:"text-slate-400 mt-1",children:"Manage school access for your applications"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[v.length>0&&(0,b.jsx)("select",{value:x,onChange:a=>y(a.target.value),className:"px-4 py-2 bg-slate-800 border border-slate-700 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500/20",children:v.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))}),(0,b.jsxs)("button",{onClick:()=>u("discover"),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white rounded-xl font-semibold text-sm transition-all",children:[(0,b.jsx)(h.Plus,{className:"w-4 h-4"}),"Request Access"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-green-500/20 rounded-xl",children:(0,b.jsx)(i.CheckCircle,{className:"w-6 h-6 text-green-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:z.length}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Linked Schools"})]})]})}),(0,b.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-yellow-500/20 rounded-xl",children:(0,b.jsx)(j.Clock,{className:"w-6 h-6 text-yellow-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:B.filter(a=>"pending"===a.status).length}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Pending Requests"})]})]})}),(0,b.jsx)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-blue-500/20 rounded-xl",children:(0,b.jsx)(l.Users,{className:"w-6 h-6 text-blue-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-white",children:z.reduce((a,b)=>a+(b.usage?.active_users||0),0).toLocaleString()}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Active Users"})]})]})})]}),(0,b.jsx)("div",{className:"flex items-center gap-1 p-1 bg-slate-800/50 border border-slate-700/50 rounded-xl w-fit",children:[{id:"linked",label:"Linked Schools",icon:i.CheckCircle},{id:"requests",label:"Access Requests",icon:j.Clock},{id:"discover",label:"Discover Schools",icon:g.Search}].map(a=>(0,b.jsxs)("button",{onClick:()=>u(a.id),className:`flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all ${t===a.id?"bg-blue-500/20 text-blue-400":"text-slate-400 hover:text-white hover:bg-slate-700/50"}`,children:[(0,b.jsx)(a.icon,{className:"w-4 h-4"}),a.label]},a.id))}),(0,b.jsxs)(e.AnimatePresence,{mode:"wait",children:["linked"===t&&(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:0===z.length?(0,b.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-12 text-center",children:[(0,b.jsx)(f.Building2,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No linked schools yet"}),(0,b.jsx)("p",{className:"text-slate-400 mb-6 max-w-md mx-auto",children:"Request access to schools to start integrating with their data."}),(0,b.jsxs)("button",{onClick:()=>u("discover"),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-blue-600 text-white rounded-xl font-semibold",children:[(0,b.jsx)(g.Search,{className:"w-4 h-4"}),"Discover Schools"]})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:z.map(a=>(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl p-6 hover:border-slate-600 transition-all group",children:[(0,b.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-xl bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-slate-600 flex items-center justify-center flex-shrink-0",children:a.school_logo?(0,b.jsx)("img",{src:a.school_logo,alt:"",className:"w-10 h-10 rounded-lg"}):(0,b.jsx)(f.Building2,{className:"w-7 h-7 text-blue-400"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-white truncate",children:a.school_name}),(0,b.jsxs)("p",{className:"text-sm text-slate-400 flex items-center gap-1",children:[(0,b.jsx)(q.MapPin,{className:"w-3 h-3"}),a.location.city,", ",a.location.state]}),(0,b.jsxs)("p",{className:"text-xs text-slate-500 mt-1",children:["Linked ",new Date(a.linked_at).toLocaleDateString()]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,b.jsxs)("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[(0,b.jsx)("p",{className:"text-lg font-semibold text-white",children:(a.usage?.api_calls_30d||0).toLocaleString()}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"API Calls (30d)"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 rounded-lg p-3",children:[(0,b.jsx)("p",{className:"text-lg font-semibold text-white",children:(a.usage?.active_users||0).toLocaleString()}),(0,b.jsx)("p",{className:"text-xs text-slate-400",children:"Active Users"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-slate-500 mb-2",children:"Approved Scopes:"}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-1",children:[a.approved_scopes.slice(0,3).map(a=>(0,b.jsx)("span",{className:"text-xs bg-blue-500/10 text-blue-400 px-2 py-0.5 rounded border border-blue-500/20",children:a.split(".")[1]},a)),a.approved_scopes.length>3&&(0,b.jsxs)("span",{className:"text-xs text-slate-500",children:["+",a.approved_scopes.length-3," more"]})]})]})]},a.school_id))})},"linked"),"requests"===t&&(0,b.jsx)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"bg-slate-800/50 border border-slate-700/50 rounded-2xl overflow-hidden",children:0===B.length?(0,b.jsxs)("div",{className:"p-12 text-center",children:[(0,b.jsx)(j.Clock,{className:"w-12 h-12 text-slate-500 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No pending requests"}),(0,b.jsx)("p",{className:"text-slate-400",children:"All your access requests have been processed."})]}):(0,b.jsx)("div",{className:"divide-y divide-slate-700/50",children:B.map(a=>(0,b.jsxs)("div",{className:"p-6 hover:bg-slate-700/20 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-lg bg-slate-700 flex items-center justify-center",children:(0,b.jsx)(f.Building2,{className:"w-5 h-5 text-slate-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-medium text-white",children:a.school_name}),(0,b.jsxs)("p",{className:"text-sm text-slate-400",children:["Requested ",new Date(a.requested_at).toLocaleDateString()]})]})]}),(a=>{switch(a){case"approved":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-green-500/20 text-green-400 rounded-lg text-xs font-medium",children:[(0,b.jsx)(i.CheckCircle,{className:"w-3 h-3"}),"Approved"]});case"pending":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded-lg text-xs font-medium",children:[(0,b.jsx)(j.Clock,{className:"w-3 h-3"}),"Pending"]});case"rejected":return(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-red-500/20 text-red-400 rounded-lg text-xs font-medium",children:[(0,b.jsx)(k.XCircle,{className:"w-3 h-3"}),"Rejected"]});default:return null}})(a.status)]}),(0,b.jsx)("p",{className:"text-sm text-slate-300 mb-3",children:a.purpose}),(0,b.jsx)("div",{className:"flex flex-wrap gap-1",children:a.requested_scopes.map(a=>(0,b.jsx)("span",{className:"text-xs bg-slate-700/50 text-slate-400 px-2 py-0.5 rounded",children:a},a))})]},a.id))})},"requests"),"discover"===t&&(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(g.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),(0,b.jsx)("input",{type:"text",value:F,onChange:a=>G(a.target.value),placeholder:"Search schools by name, code, or city...",className:"w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:V.map(a=>{let c=z.some(b=>b.school_id===a.id),e=B.some(b=>b.school_id===a.id&&"pending"===b.status);return(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:`bg-slate-800/50 border rounded-2xl p-5 transition-all ${c?"border-green-500/30 bg-green-500/5":e?"border-yellow-500/30 bg-yellow-500/5":"border-slate-700/50 hover:border-slate-600"}`,children:[(0,b.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500/20 to-purple-500/20 border border-slate-600 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(f.Building2,{className:"w-6 h-6 text-blue-400"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h3",{className:"font-semibold text-white truncate",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:a.code})]})]}),(0,b.jsxs)("div",{className:"space-y-2 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[(0,b.jsx)(q.MapPin,{className:"w-4 h-4"}),a.location.city,", ",a.location.state]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-slate-400",children:[(0,b.jsx)(l.Users,{className:"w-4 h-4"}),a.student_count.toLocaleString()," students"]})]}),c?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-400 text-sm",children:[(0,b.jsx)(i.CheckCircle,{className:"w-4 h-4"}),"Already Linked"]}):e?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-yellow-400 text-sm",children:[(0,b.jsx)(j.Clock,{className:"w-4 h-4"}),"Request Pending"]}):(0,b.jsxs)("button",{onClick:()=>{K(a),I(!0)},className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-500/20 hover:bg-blue-500/30 text-blue-400 rounded-lg text-sm font-medium transition-colors",children:["Request Access",(0,b.jsx)(n.ChevronRight,{className:"w-4 h-4"})]})]},a.id)})})]},"discover")]}),(0,b.jsx)(e.AnimatePresence,{children:H&&J&&(0,b.jsx)(d.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",onClick:()=>I(!1),children:(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"w-full max-w-lg bg-slate-800 border border-slate-700 rounded-2xl shadow-xl max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"p-6 border-b border-slate-700",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Request School Access"}),(0,b.jsxs)("p",{className:"text-sm text-slate-400 mt-1",children:["Request access to ",J.name]})]}),(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-slate-900/50 rounded-xl",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:(0,b.jsx)(f.Building2,{className:"w-6 h-6 text-blue-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-white",children:J.name}),(0,b.jsxs)("p",{className:"text-sm text-slate-400",children:[J.location.city,", ",J.location.state]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Purpose of Access *"}),(0,b.jsx)("textarea",{value:L,onChange:a=>M(a.target.value),rows:3,className:"w-full px-4 py-3 bg-slate-900/50 border border-slate-600 rounded-xl text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20",placeholder:"Describe why your application needs access to this school's data..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Requested Permissions *"}),(0,b.jsx)("div",{className:"space-y-2",children:[{id:"student.profile.read",label:"Student Profiles",description:"Read student names, grades, sections"},{id:"student.attendance.read",label:"Attendance Data",description:"Read attendance records"},{id:"student.academic.read",label:"Academic Records",description:"Read grades and marks"},{id:"student.timetable.read",label:"Timetable",description:"Read class schedules"},{id:"school.structure.read",label:"School Structure",description:"Read classes, sections, subjects"},{id:"wellbeing.mood.read",label:"Wellbeing Data",description:"Read mood and wellness (requires consent)"}].map(a=>(0,b.jsxs)("label",{className:`flex items-start gap-3 p-3 rounded-xl border cursor-pointer transition-colors ${N.includes(a.id)?"bg-blue-500/20 border-blue-500/50":"bg-slate-900/50 border-slate-700 hover:border-slate-600"}`,children:[(0,b.jsx)("input",{type:"checkbox",checked:N.includes(a.id),onChange:b=>{b.target.checked?O([...N,a.id]):O(N.filter(b=>b!==a.id))},className:"mt-0.5 w-4 h-4 rounded border-slate-600 bg-slate-900 text-blue-500 focus:ring-blue-500"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-white",children:a.label}),(0,b.jsx)("p",{className:"text-xs text-slate-500",children:a.description})]})]},a.id))})]}),(0,b.jsx)("div",{className:"p-4 bg-amber-500/10 border border-amber-500/20 rounded-xl",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(p.AlertTriangle,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-amber-400",children:"Data Usage Agreement"}),(0,b.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:"By requesting access, you agree to handle all data in accordance with our data protection policies and applicable privacy laws (GDPR, DPDP Act, FERPA)."})]})]})})]}),(0,b.jsxs)("div",{className:"p-6 border-t border-slate-700 flex items-center justify-end gap-3",children:[(0,b.jsx)("button",{onClick:()=>I(!1),className:"px-4 py-2 text-slate-300 hover:text-white transition-colors",children:"Cancel"}),(0,b.jsxs)("button",{onClick:U,disabled:P||!L||0===N.length,className:"flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 disabled:from-slate-600 disabled:to-slate-600 text-white rounded-xl font-semibold text-sm transition-all",children:[P?(0,b.jsx)(o.Loader2,{className:"w-4 h-4 animate-spin"}):(0,b.jsx)(m.Shield,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:P?"Submitting...":"Submit Request"})]})]})]})})})]})}a.s(["default",()=>s])}];

//# sourceMappingURL=developer_src_app_dashboard_schools_page_tsx_bd0c4901._.js.map