module.exports=[12513,e=>{"use strict";var t=e.i(47909),r=e.i(74017),i=e.i(96250),a=e.i(59756),n=e.i(61916),o=e.i(14444),s=e.i(37092),l=e.i(69741),d=e.i(16795),u=e.i(87718),c=e.i(95169),p=e.i(47587),_=e.i(66012),h=e.i(70101),f=e.i(26937),R=e.i(10372),g=e.i(93695);e.i(52474);var v=e.i(5232),m=e.i(89171),w=e.i(87464);e.i(94879);var E=e.i(87022),x=e.i(93458),y=e.i(54799);let S=()=>{let e="https://kbyeiqzxuaslqquhpyvi.supabase.co",t=process.env.DEV_SUPABASE_SERVICE_ROLE_KEY||process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Supabase admin credentials not configured");return(0,w.createClient)(e,t,{auth:{autoRefreshToken:!1,persistSession:!1}})};async function N(){try{let e=await (0,x.cookies)(),t=(0,E.createServerClient)("https://fsvuhhticbfjftnwzsue.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZzdnVoaHRpY2JmamZ0bnd6c3VlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3NDI3ODYsImV4cCI6MjA3MjMxODc4Nn0.7Rj52xyoIsHYm8UTWScT3rSRbhNu2Xv3jYjc_jT-Ilc",{cookies:{getAll:()=>e.getAll()}}),{data:{user:r}}=await t.auth.getUser();return r}catch(e){return console.error("Auth error:",e),null}}function C(){return`cw_ac_${y.default.randomBytes(32).toString("hex")}`}async function I(e){let{searchParams:t}=new URL(e.url),r=t.get("client_id"),i=t.get("redirect_uri"),a=t.get("response_type"),n=t.get("scope"),o=t.get("state"),s=t.get("code_challenge"),l=t.get("code_challenge_method");if(!r)return m.NextResponse.json({error:"invalid_request",error_description:"Missing client_id parameter"},{status:400});if("code"!==a)return m.NextResponse.json({error:"unsupported_response_type",error_description:"Only authorization code flow is supported"},{status:400});try{let t,a=S(),{data:d,error:u}=await a.from("developer_applications").select("*").eq("client_id",r).single();if(u||!d)return m.NextResponse.json({error:"invalid_client",error_description:"Unknown client_id"},{status:400});if("approved"!==d.status&&"sandbox"!==d.environment)return m.NextResponse.json({error:"unauthorized_client",error_description:"Application is not approved for production use"},{status:403});if(i&&!function(e,t){try{let r=new URL(e);for(let i of t){if(e===i)return!0;if(i.includes("*")){let t=i.replace(/\*/g,".*");if(RegExp(`^${t}$`).test(e))return!0}try{let e=new URL(i);if(r.origin===e.origin&&r.pathname.startsWith(e.pathname))return!0}catch{}}return!1}catch{return!1}}(i,d.redirect_uris||[]))return m.NextResponse.json({error:"invalid_redirect_uri",error_description:"Redirect URI not registered for this application"},{status:400});let c=n?n.split(" ").filter(Boolean):["profile.read"],p=d.allowed_scopes?.length>0?d.allowed_scopes:d.requested_scopes,_=(t=c.filter(e=>!p.includes(e)&&"openid"!==e),{valid:0===t.length,invalid:t});if(!_.valid)return m.NextResponse.json({error:"invalid_scope",error_description:`Invalid scopes: ${_.invalid.join(", ")}`},{status:400});let{data:h}=await a.from("scope_definitions").select("*").in("scope_name",c),f=await N();if(!f){let t=new URL("/login",process.env.NEXT_PUBLIC_MAIN_APP_URL||"http://localhost:3000");return t.searchParams.set("return_to",e.url),m.NextResponse.redirect(t.toString())}let{data:R}=await a.from("oauth_user_authorizations").select("*").eq("user_id",f.id).eq("application_id",d.id).eq("is_active",!0).single();if(R){let e=R.granted_scopes||[],t=c.filter(t=>!e.includes(t));if(0===t.length){let e=C(),t=new Date(Date.now()+6e5);await a.from("oauth_authorization_codes").insert({code:e,application_id:d.id,user_id:f.id,redirect_uri:i||d.redirect_uris[0],scopes:c,code_challenge:s||null,code_challenge_method:l||null,expires_at:t.toISOString()});let r=new URL(i||d.redirect_uris[0]);return r.searchParams.set("code",e),o&&r.searchParams.set("state",o),m.NextResponse.redirect(r.toString())}}return m.NextResponse.json({app:{id:d.id,name:d.name,description:d.description,logo_url:d.logo_url,website_url:d.website_url,privacy_policy_url:d.privacy_policy_url,is_verified:d.is_verified,trust_level:d.trust_level},scopes:h||c.map(e=>({scope_name:e,display_name:e,description:""})),user:{id:f.id,email:f.email,name:f.user_metadata?.full_name||f.email},params:{client_id:r,redirect_uri:i||d.redirect_uris[0],scope:c.join(" "),state:o,code_challenge:s,code_challenge_method:l}})}catch(e){return console.error("OAuth authorize error:",e),m.NextResponse.json({error:"server_error",error_description:e.message||"Internal server error"},{status:500})}}async function A(e){try{let{client_id:t,redirect_uri:r,scope:i,state:a,code_challenge:n,code_challenge_method:o,decision:s}=await e.json(),l=await N();if(!l)return m.NextResponse.json({error:"unauthorized",error_description:"User not authenticated"},{status:401});let d=S(),{data:u}=await d.from("developer_applications").select("*").eq("client_id",t).single();if(!u)return m.NextResponse.json({error:"invalid_client",error_description:"Unknown client_id"},{status:400});if("deny"===s){let e=new URL(r||u.redirect_uris[0]);return e.searchParams.set("error","access_denied"),e.searchParams.set("error_description","User denied the authorization request"),a&&e.searchParams.set("state",a),m.NextResponse.json({redirect_url:e.toString()})}let c=C(),p=i?i.split(" ").filter(Boolean):["profile.read"],_=new Date(Date.now()+6e5);await d.from("oauth_authorization_codes").insert({code:c,application_id:u.id,user_id:l.id,redirect_uri:r||u.redirect_uris[0],scopes:p,code_challenge:n||null,code_challenge_method:o||null,expires_at:_.toISOString()});let{data:h}=await d.from("oauth_user_authorizations").select("id, granted_scopes").eq("user_id",l.id).eq("application_id",u.id).single();if(h){let e=[...new Set([...h.granted_scopes,...p])];await d.from("oauth_user_authorizations").update({granted_scopes:e,updated_at:new Date().toISOString()}).eq("id",h.id)}else await d.from("oauth_user_authorizations").insert({user_id:l.id,application_id:u.id,granted_scopes:p,is_active:!0});let f=new URL(r||u.redirect_uris[0]);return f.searchParams.set("code",c),a&&f.searchParams.set("state",a),await d.from("developer_activity_logs").insert({developer_id:u.developer_id,application_id:u.id,action:"user_authorized",resource_type:"authorization",details:{user_id:l.id,scopes:p}}),m.NextResponse.json({redirect_url:f.toString()})}catch(e){return console.error("OAuth authorize POST error:",e),m.NextResponse.json({error:"server_error",error_description:e.message||"Internal server error"},{status:500})}}e.s(["GET",()=>I,"POST",()=>A],9175);var P=e.i(9175);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/oauth/authorize/route",pathname:"/api/oauth/authorize",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/developer/src/app/api/oauth/authorize/route.ts",nextConfigOutput:"",userland:P}),{workAsyncStorage:U,workUnitAsyncStorage:b,serverHooks:T}=O;function j(){return(0,i.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:b})}async function q(e,t,i){O.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/oauth/authorize/route";m=m.replace(/\/index$/,"")||"/";let w=await O.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==i.waitUntil||i.waitUntil.call(i,Promise.resolve()),null;let{buildId:E,params:x,nextConfig:y,parsedUrl:S,isDraftMode:N,prerenderManifest:C,routerServerContext:I,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,resolvedPathname:U,clientReferenceManifest:b,serverActionsManifest:T}=w,j=(0,l.normalizeAppPath)(m),q=!!(C.dynamicRoutes[j]||C.routes[U]),z=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,S,!1):t.end("This page could not be found"),null);if(q&&!N){let e=!!C.routes[U],t=C.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(y.experimental.adapterPath)return await z();throw new g.NoFallbackError}}let D=null;!q||O.isDev||N||(D="/index"===(D=U)?"/":D);let M=!0===O.isDev||!q,k=q&&!M;T&&b&&(0,o.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:b,serverActionsManifest:T,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:T})});let H=e.method||"GET",L=(0,n.getTracer)(),$=L.getActiveScopeSpan(),B={params:x,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!y.experimental.authInterrupts},cacheComponents:!!y.cacheComponents,supportsDynamicResponse:M,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:y.cacheLife,waitUntil:i.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,i)=>O.onRequestError(e,t,i,I)},sharedContext:{buildId:E}},F=new d.NodeNextRequest(e),K=new d.NodeNextResponse(t),V=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let o=async e=>O.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=L.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let i=r.get("next.route");if(i){let t=`${H} ${i}`;e.setAttributes({"next.route":i,"http.route":i,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${m}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&A&&P&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&i.waitUntil&&(i.waitUntil(l),l=void 0);let d=B.renderOpts.collectedTags;if(!q)return await (0,_.sendResponse)(F,K,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[R.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,i=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:i}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})},I),t}},u=await O.handleResponse({req:e,nextConfig:y,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:A,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:i.waitUntil,isMinimalMode:s});if(!q)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",A?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,h.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&q||c.delete(R.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(u.cacheControl)),await (0,_.sendResponse)(F,K,new Response(u.value.body,{headers:c,status:u.value.status||200})),null};$?await l($):await L.withPropagatedContext(e.headers,()=>L.trace(c.BaseServerSpan.handleRequest,{spanName:`${H} ${m}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:k,isOnDemandRevalidate:A})}),q)throw t;return await (0,_.sendResponse)(F,K,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>j,"routeModule",()=>O,"serverHooks",()=>T,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>b],12513)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_279878b3.js.map